{% extends "admin/base_site.html" %}
{% load i18n admin_static %}
{% load url from future %}

{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL}}main.css" %}" />
{% endblock %}

{% block title %}Print Student List | {% trans 'Django site admin' %}{% endblock %}

{% block content_title %}<h1>Enter exam results</h1>{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label='student_manager' %}">Student_manager</a>
&rsaquo; <a href="{% url 'admin:student_manager_exam_changelist' %}">Exams</a> &rsaquo; Enter exam results
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <form action="{% url 'save_exam_results' %}" method="post">
      {{ formset.management_form }}
      {{ num_exercises_form }}
      {{ formset.nonfield_errors }}
      <div>
	{% csrf_token %}
	<fieldset>
	  <table class="exam-results">
	    <thead>
	      <tr>
		<th>Student</th>
		{% for num in num_exercises %}
		<th>Exercise {{ num }}</th>
		{% endfor %}
		<th>Total</th>
	      </tr>
	    </thead>
	    {% for form in formset %}
	      <tr onchange="updateTotal(this)">
		<td>{{ form.instance.student }}</td>
		{% for num in num_exercises %}
		<td class="subpoints"><input type="text" /></td>
		{% endfor %}
		<td class="total">{{ form.points }}{{ form.points.errors }}
		  {% for field in form.hidden_fields %}
		  {{ field }}{{ field.errors }}
		  {% endfor %}
		</td>
	      </tr>
	    {% endfor %}
	  </table>
	</fieldset>
	<div class="submit-row">
	  <input type="submit" value="Submit">
	</div>
    </div>
  </form>
</div>

<script>
function updateTotal(row) {
  var subpoints = row.getElementsByClassName("subpoints");
  var sum = 0;
  for (var i = 0; i < subpoints.length; i++) {
    val = subpoints[i].getElementsByTagName('input')[0].value;
    if (val) sum += parseFloat(val);
  }
  var total = row.getElementsByClassName("total")[0];
  total.getElementsByTagName('input')[0].value = sum;
}
</script>
{% endblock %}
